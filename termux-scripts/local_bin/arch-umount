#!/data/data/com.termux/files/usr/bin/sh

# 如果不是 root, 使用 su -c 重新执行脚本自身
if [ "$(id -u)" -ne 0 ]; then
    # shellcheck disable=SC2016
    exec su -c 'exec "$0" "$@"' "$0" "$@"
fi

# Chroot 路径
ChrootPath="/data/local/tmp/arch"

# 颜色定义
CYAN='\033[0;36m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
RED='\033[0;31m'
RESET='\033[0m'

# 输出函数
print_info() { printf "${CYAN}[i]${RESET} %s\n" "$1"; }
print_success() { printf "${GREEN}[+]${RESET} %s\n" "$1"; }
print_warning() { printf "${YELLOW}[!]${RESET} %s\n" "$1"; }
print_error() { printf "${RED}[-]${RESET} %s\n" "$1"; }

# 取消挂载文件系统
Mounts="sdcard tmp proc sys dev/shm dev/pts dev"

for target in $Mounts; do
    fullpath="$ChrootPath/$target"
    if mountpoint -q "$fullpath"; then
        if umount -l "$fullpath" 2> /dev/null; then
            print_success "卸载: $fullpath"
        else
            print_error "失败: $fullpath"
        fi
    else
        print_warning "跳过: $fullpath"
    fi
done
